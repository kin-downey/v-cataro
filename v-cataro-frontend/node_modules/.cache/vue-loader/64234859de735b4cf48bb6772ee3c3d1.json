{"remainingRequest":"/Users/ykin/Documents/Projects/v-cataro-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ykin/Documents/Projects/v-cataro-frontend/src/components/Recognition.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/ykin/Documents/Projects/v-cataro-frontend/src/components/Recognition.vue","mtime":1635123435782},{"path":"/Users/ykin/Documents/Projects/v-cataro-frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/ykin/Documents/Projects/v-cataro-frontend/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/ykin/Documents/Projects/v-cataro-frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/ykin/Documents/Projects/v-cataro-frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGltcG9ydCBmaXJlYmFzZSBmcm9tICIuLi9maXJlYmFzZS5qcyI7CmltcG9ydCAqIGFzIGZhY2VhcGkgZnJvbSAiZmFjZS1hcGkuanMiOwppbXBvcnQga3Vyb21vamkgZnJvbSAia3Vyb21vamkiOwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwovL2ltcG9ydCAqIGFzIGNhbnZhcyBmcm9tICdjYW52YXMnOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJ2b2ljZSIsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHNob3dfYnV0dG9uOiB0cnVlLAogICAgICB1c2VyX2VtYWlsOiAiIiwKICAgICAgd29yZDogIiIsCiAgICAgIHRleHQ6ICIiLAogICAgICBhbmdyeTogIiIsCiAgICAgIGRpc2d1c3RlZDogIiIsCiAgICAgIGZlYXJmdWw6ICIiLAogICAgICBoYXBweTogIiIsCiAgICAgIG5ldXRyYWw6ICIiLAogICAgICBzYWQ6ICIiLAogICAgICBzdXJwcmlzZWQ6ICIiLAogICAgICB0aW1lc3RhbXA6ICIiLAogICAgICBjaGFuZ2VkX2lkOiAiIiwKICAgICAgdGltZXI6IG51bGwsCiAgICAgIGNhbnZhczogbnVsbCwKICAgICAgdmlkZW86IG51bGwsCiAgICAgIHJlY29nbml0aW9uOiBudWxsLAogICAgICBrZXlfd29yZDogIiIsCiAgICAgIGNvdW50OiAwLAogICAgICBmbGFnOiBmYWxzZSwKICAgICAgbXNnOiAiIiwKICAgICAgbW92ZV9tb3VzZV9vYmo6IG51bGwsCiAgICAgIHVzZXJfbmFtZTogIuOBk+OCk+OBq+OBoeOBr+OAguOAgiIsCiAgICAgIGFpZHV0aV9vYmo6IG51bGwsCiAgICAgIHJlY29nX2ZsYWc6IDAsCiAgICB9OwogIH0sCiAgbW91bnRlZCgpIHsKICAgIC8vUEPjga7jg5Xjg63jg7Pjg4jjgqvjg6Hjg6njgpLotbfli5XjgZfjgIHjg6rjgqLjg6vjgr/jgqTjg6Djga7mmKDlg4/jgpJ2aWRlb+OCv+OCsOOBq+ihqOekuuOBmeOCiwogICAgdGhpcy52aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWRlbyIpOwogICAgaWYgKG5hdmlnYXRvci5tZWRpYURldmljZXMgJiYgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpIHsKICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcwogICAgICAgIC5nZXRVc2VyTWVkaWEoeyBhdWRpbzogZmFsc2UsIHZpZGVvOiB0cnVlIH0pCiAgICAgICAgLnRoZW4oKHN0cmVhbSkgPT4gewogICAgICAgICAgdGhpcy52aWRlby5zcmNPYmplY3QgPSBzdHJlYW07CiAgICAgICAgfSk7CiAgICB9CgogICAgdGhpcy5jYW52YXMgPSB0aGlzLiRyZWZzLmNhbnZhczsKICB9LAoKICBtZXRob2RzOiB7CiAgICBvbmNsaWNrKCkgewogICAgICB0aGlzLnNob3dfYnV0dG9uID0gZmFsc2U7CiAgICAgIC8vIHRoaXMuc2V0X2VtYWlsKCk7CiAgICAgIHRoaXMuaW5pdF9yZWNvZ25pdGlvbigpOwogICAgfSwKCgogICAgYXN5bmMgaW5pdF9yZWNvZ25pdGlvbigpIHsKICAgICAgdGhpcy5yZWNvZ25pdGlvbiA9IG5ldyB3aW5kb3cud2Via2l0U3BlZWNoUmVjb2duaXRpb24oKTsKCiAgICAgIHRoaXMucmVjb2duaXRpb24ubGFuZyA9ICJqYS1KUCI7CiAgICAgIHRoaXMucmVjb2duaXRpb24uaW50ZXJpbVJlc3VsdHMgPSB0cnVlOwogICAgICB0aGlzLnJlY29nbml0aW9uLmNvbnRpbnVvdXMgPSB0cnVlOwogICAgICB0aGlzLnJlY29nbml0aW9uLm9uZW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCJ2b2ljZSBpcyBlbmRlZCIpOwogICAgICB9OwogICAgICBhd2FpdCBmYWNlYXBpLmxvYWRTc2RNb2JpbGVuZXR2MU1vZGVsKCIvbW9kZWxzIik7CiAgICAgIGF3YWl0IGZhY2VhcGkubG9hZEZhY2VFeHByZXNzaW9uTW9kZWwoIi9tb2RlbHMiKTsKICAgICAgdGhpcy5mYWNlX3JlY29nKCk7CiAgICAgIGNvbnNvbGUubG9nKCJjb21wbGV0ZSIpOwogICAgICBjb25zdCB0ZXh0ID0gIuOBk+OCk+OBq+OBoeOBr++8jOS7iuaXpeOBr+m2j+OCkumjn+OBueOBvuOBl+OBn++8jiI7CiAgICAgIGNvbnNvbGUubG9nKHRleHQpOwogICAgICBrdXJvbW9qaS5idWlsZGVyKHsgZGljUGF0aDogIi9kaWN0IiB9KS5idWlsZCgoZXJyLCB0b2tlbml6ZXIpID0+IHsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCB0b2tlbnMgPSB0b2tlbml6ZXIudG9rZW5pemUodGV4dCk7CiAgICAgICAgICBmb3IgKGxldCB0b2tlbiBvZiB0b2tlbnMpIHsKICAgICAgICAgICAgaWYgKHRva2VuLnBvcyA9PSAi5ZCN6KmeIikgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJ0b2tlbjogIiwgdG9rZW4uYmFzaWNfZm9ybSk7CiAgICAgICAgICAgICAgLy8gY29uc3Qga2V5X3dvcmQgPSB0b2tlbi5iYXNpY19mb3JtOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuYWlkdXRpKCk7CiAgICAgICAgdGhpcy5zdGFydF9yZWNvZ25pdGlvbigpOwogICAgICB9KTsKICAgIH0sCiAgICBzdGFydF9yZWNvZ25pdGlvbigpIHsKICAgICAgdGhpcy5yZWNvZ25pdGlvbi5vbnJlc3VsdCA9IChldmVudCkgPT4gewogICAgICAgIGZvciAobGV0IGkgPSBldmVudC5yZXN1bHRJbmRleDsgaSA8IGV2ZW50LnJlc3VsdHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGxldCB0cmFuc2NyaXB0ID0gZXZlbnQucmVzdWx0c1tpXVswXS50cmFuc2NyaXB0OwogICAgICAgICAgaWYgKGV2ZW50LnJlc3VsdHNbaV0uaXNGaW5hbCkgewogICAgICAgICAgICAvL2ZpbmFsVHJhbnNjcmlwdCArPSB0cmFuc2NyaXB0OwogICAgICAgICAgICB0aGlzLnRleHQgPSB0cmFuc2NyaXB0OwogICAgICAgICAgICB0aGlzLnJlY29nbml0aW9uLnN0b3AoKTsKICAgICAgICAgICAgdGhpcy5hbmFseXNpcyh0aGlzLnRleHQpOwogICAgICAgICAgICB0aGlzLmZhY2VfcmVjb2coKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICAgIHRoaXMucmVjb2duaXRpb24uc3RhcnQoKTsKICAgIH0sCiAgICBhc3luYyBmYWNlX3JlY29nKCkgewogICAgICBjb25zdCBkZXRlY3Rpb25XaXRoRXhwcmVzc2lvbnMgPSBhd2FpdCBmYWNlYXBpCiAgICAgICAgLmRldGVjdFNpbmdsZUZhY2UodGhpcy52aWRlbykKICAgICAgICAud2l0aEZhY2VFeHByZXNzaW9ucygpOwoKICAgICAgKHRoaXMubmV1dHJhbCA9IGRldGVjdGlvbldpdGhFeHByZXNzaW9ucy5leHByZXNzaW9ucy5uZXV0cmFsKSwKICAgICAgICAodGhpcy5oYXBweSA9IGRldGVjdGlvbldpdGhFeHByZXNzaW9ucy5leHByZXNzaW9ucy5oYXBweSksCiAgICAgICAgKHRoaXMuc2FkID0gZGV0ZWN0aW9uV2l0aEV4cHJlc3Npb25zLmV4cHJlc3Npb25zLnNhZCksCiAgICAgICAgKHRoaXMuYW5ncnkgPSBkZXRlY3Rpb25XaXRoRXhwcmVzc2lvbnMuZXhwcmVzc2lvbnMuYW5ncnkpLAogICAgICAgICh0aGlzLmZlYXJmdWwgPSBkZXRlY3Rpb25XaXRoRXhwcmVzc2lvbnMuZXhwcmVzc2lvbnMuZmVhcmZ1bCksCiAgICAgICAgKHRoaXMuZGlzZ3VzdGVkID0gZGV0ZWN0aW9uV2l0aEV4cHJlc3Npb25zLmV4cHJlc3Npb25zLmRpc2d1c3RlZCksCiAgICAgICAgKHRoaXMuc3VycHJpc2VkID0gZGV0ZWN0aW9uV2l0aEV4cHJlc3Npb25zLmV4cHJlc3Npb25zLnN1cnByaXNlZCk7CgogICAgICBjbGVhckludGVydmFsKHRoaXMuYWlkdXRpX29iaik7CiAgICB9LAogICAgYXBpX3Bvc3Q6IGZ1bmN0aW9uKGtleV93b3JkKSB7CiAgICAgIGxldCBfdGhpcyA9IHRoaXMKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgiaHR0cDovL2xvY2FsaG9zdDo4MDAwL2hlbGxvL2Fuc3dlciAiLCB7CiAgICAgICAgICAid29yZCI6IGtleV93b3JkLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhLnNlbnRlbmNlKTsKICAgICAgICAgIF90aGlzLnNwZWFrKHJlc3BvbnNlLmRhdGEuc2VudGVuY2UpOwogICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICBfdGhpcy53b3JkID0gIiI7CiAgICAgICAgfSk7CiAgICB9LAogICAgYXN5bmMgYW5hbHlzaXMoaW5wdXRfdGV4dCkgewogICAgICBjb25zdCB0ZXh0ID0gaW5wdXRfdGV4dDsKICAgICAgdmFyIGtleV93b3JkID0gIiI7CiAgICAgIGt1cm9tb2ppLmJ1aWxkZXIoeyBkaWNQYXRoOiAiL2RpY3QiIH0pLmJ1aWxkKChlcnIsIHRva2VuaXplcikgPT4gewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IHRva2VucyA9IHRva2VuaXplci50b2tlbml6ZSh0ZXh0KTsKICAgICAgICAgIGZvciAobGV0IHRva2VuIG9mIHRva2VucykgewogICAgICAgICAgICBpZiAodG9rZW4ucG9zID09ICLlkI3oqZ4iKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coInRva2VuOiAiLCB0b2tlbi5iYXNpY19mb3JtKTsKICAgICAgICAgICAgICBrZXlfd29yZCA9IHRva2VuLmJhc2ljX2Zvcm07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGNvbnNvbGUubG9nKCJmb3Iga2V5X3dvcmQ6ICIsIGtleV93b3JkKTsKICAgICAgICAgIC8vIHRoaXMuc3BlYWsoa2V5X3dvcmQpOwogICAgICAgICAgdGhpcy5hcGlfcG9zdChrZXlfd29yZCk7CgogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgYWlkdXRpKCkgewogICAgICBjb25zdCB1dHRyID0gbmV3IFNwZWVjaFN5bnRoZXNpc1V0dGVyYW5jZSgpOwogICAgICB2YXIgbW92ZV9tb3VzZV9vYmogPSB0aGlzLm1vdmVfbW91c2UoKTsKICAgICAgdXR0ci50ZXh0ID0gIuOBk+OCk+OBq+OBoeOBr+OAguaYqOaXpeOBruWknOOBlOmjr+OBq+S9leOCkumjn+OBueOBvuOBl+OBn+OBi++8nyI7CiAgICAgIHV0dHIubGFuZyA9ICJqYSI7CiAgICAgIHNwZWVjaFN5bnRoZXNpcy5zcGVhayh1dHRyKTsKICAgICAgdXR0ci5vbmVuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBjbGVhckludGVydmFsKG1vdmVfbW91c2Vfb2JqKTsKICAgICAgfTsKICAgIH0sCiAgICBhc3luYyBzcGVhayhrZXlfd29yZCkgewogICAgICBjb25zdCB1dHRyID0gbmV3IFNwZWVjaFN5bnRoZXNpc1V0dGVyYW5jZSgpOwogICAgICB2YXIgbW92ZV9tb3VzZV9vYmogPSB0aGlzLm1vdmVfbW91c2UoKTsKICAgICAgdXR0ci50ZXh0ID0ga2V5X3dvcmQ7CiAgICAgIHV0dHIubGFuZyA9ICJqYSI7CiAgICAgIHNwZWVjaFN5bnRoZXNpcy5zcGVhayh1dHRyKTsKICAgICAgdGhpcy51c2VyX25hbWUgPSAiIjsKICAgICAgY29uc3QgcmVjb2duaXRpb24gPSB0aGlzLnJlY29nbml0aW9uOwogICAgICAvLyDllovjgorntYLjgo/jgaPjgZ/jgonvvIzlj6Pjga7li5XjgY3jgpLmraLjgoHjgosKICAgICAgdXR0ci5vbmVuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBjbGVhckludGVydmFsKG1vdmVfbW91c2Vfb2JqKTsKICAgICAgICByZWNvZ25pdGlvbi5zdGFydCgpOwogICAgICB9OwogICAgfSwKICAgIG1vdmVfbW91c2UoKSB7CiAgICAgIHRoaXMubW92ZV9tb3VzZV9vYmogPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgdGhpcy5jb3VudCsrOwogICAgICAgIGlmICh0aGlzLmNvdW50ICUgMiA9PSAwKSB7CiAgICAgICAgICB0aGlzLmZsYWcgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmZsYWcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICAgIHJldHVybiB0aGlzLm1vdmVfbW91c2Vfb2JqOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["Recognition.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Recognition.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <v-app>\n    <v-main>\n      <v-row>\n        <v-col align=\"center\">\n          <img\n            v-if=\"flag\"\n            src=\"../../public/CATARO_a_1.png\"\n            alt=\"open_mouse\"\n            width=\"450\"\n            height=\"auto\"\n          />\n          <img\n            v-else\n            src=\"../../public/CATARO_a_2.png\"\n            alt=\"close_mouse\"\n            width=\"450\"\n            height=\"auto\"\n          />\n        </v-col>\n      </v-row>\n      <v-btn @click=\"api_post()\">post</v-btn>\n      <div v-if=\"show_button\">\n        <v-row align=\"center\">\n          <v-col align=\"center\">\n            <v-btn color=\"primary\" @click=\"onclick()\"> 実験開始 </v-btn>\n          </v-col>\n        </v-row>\n      </div>\n      <div v-else>\n        <v-row align=\"center\">\n          <v-col align=\"center\">\n            <h3>実験が開始されました</h3>\n            <h4>対話開始まで10秒ほどかかる場合があります．</h4>\n          </v-col>\n        </v-row>\n      </div>\n      <v-row class=\"mt-5\">\n        <v-col align=\"center\">\n          <p>{{ text }}</p>\n        </v-col>\n      </v-row>\n      <v-row>\n        <v-col class=\"mx-4\">\n          <div>\n            <p>neutral: {{ neutral }}</p>\n            <p>happy: {{ happy }}</p>\n            <p>angry: {{ angry }}</p>\n            <p>sad: {{ sad }}</p>\n            <p>surprised: {{ surprised }}</p>\n            <p>fearful: {{ fearful }}</p>\n            <p>disgusted: {{ disgusted }}</p>\n          </div>\n        </v-col>\n        <v-col align=\"end\" class=\"mx-4\">\n          <video\n            ref=\"video\"\n            id=\"video\"\n            width=\"300\"\n            height=\"300\"\n            playsinline\n            muted\n            autoplay\n          ></video>\n          <canvas ref=\"canvas\" id=\"myCanvas\" width=\"1\" height=\"1\" />\n        </v-col>\n      </v-row>\n    </v-main>\n  </v-app>\n</template>\n\n<script>\n// import firebase from \"../firebase.js\";\nimport * as faceapi from \"face-api.js\";\nimport kuromoji from \"kuromoji\";\nimport axios from \"axios\";\n//import * as canvas from 'canvas';\n\nexport default {\n  name: \"voice\",\n  data() {\n    return {\n      show_button: true,\n      user_email: \"\",\n      word: \"\",\n      text: \"\",\n      angry: \"\",\n      disgusted: \"\",\n      fearful: \"\",\n      happy: \"\",\n      neutral: \"\",\n      sad: \"\",\n      surprised: \"\",\n      timestamp: \"\",\n      changed_id: \"\",\n      timer: null,\n      canvas: null,\n      video: null,\n      recognition: null,\n      key_word: \"\",\n      count: 0,\n      flag: false,\n      msg: \"\",\n      move_mouse_obj: null,\n      user_name: \"こんにちは。。\",\n      aiduti_obj: null,\n      recog_flag: 0,\n    };\n  },\n  mounted() {\n    //PCのフロントカメラを起動し、リアルタイムの映像をvideoタグに表示する\n    this.video = document.getElementById(\"video\");\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n      navigator.mediaDevices\n        .getUserMedia({ audio: false, video: true })\n        .then((stream) => {\n          this.video.srcObject = stream;\n        });\n    }\n\n    this.canvas = this.$refs.canvas;\n  },\n\n  methods: {\n    onclick() {\n      this.show_button = false;\n      // this.set_email();\n      this.init_recognition();\n    },\n\n\n    async init_recognition() {\n      this.recognition = new window.webkitSpeechRecognition();\n\n      this.recognition.lang = \"ja-JP\";\n      this.recognition.interimResults = true;\n      this.recognition.continuous = true;\n      this.recognition.onend = function () {\n        console.log(\"voice is ended\");\n      };\n      await faceapi.loadSsdMobilenetv1Model(\"/models\");\n      await faceapi.loadFaceExpressionModel(\"/models\");\n      this.face_recog();\n      console.log(\"complete\");\n      const text = \"こんにちは，今日は鶏を食べました．\";\n      console.log(text);\n      kuromoji.builder({ dicPath: \"/dict\" }).build((err, tokenizer) => {\n        if (err) {\n          console.log(err);\n        } else {\n          const tokens = tokenizer.tokenize(text);\n          for (let token of tokens) {\n            if (token.pos == \"名詞\") {\n              console.log(\"token: \", token.basic_form);\n              // const key_word = token.basic_form;\n            }\n          }\n        }\n        this.aiduti();\n        this.start_recognition();\n      });\n    },\n    start_recognition() {\n      this.recognition.onresult = (event) => {\n        for (let i = event.resultIndex; i < event.results.length; i++) {\n          let transcript = event.results[i][0].transcript;\n          if (event.results[i].isFinal) {\n            //finalTranscript += transcript;\n            this.text = transcript;\n            this.recognition.stop();\n            this.analysis(this.text);\n            this.face_recog();\n          }\n        }\n      };\n      this.recognition.start();\n    },\n    async face_recog() {\n      const detectionWithExpressions = await faceapi\n        .detectSingleFace(this.video)\n        .withFaceExpressions();\n\n      (this.neutral = detectionWithExpressions.expressions.neutral),\n        (this.happy = detectionWithExpressions.expressions.happy),\n        (this.sad = detectionWithExpressions.expressions.sad),\n        (this.angry = detectionWithExpressions.expressions.angry),\n        (this.fearful = detectionWithExpressions.expressions.fearful),\n        (this.disgusted = detectionWithExpressions.expressions.disgusted),\n        (this.surprised = detectionWithExpressions.expressions.surprised);\n\n      clearInterval(this.aiduti_obj);\n    },\n    api_post: function(key_word) {\n      let _this = this\n      axios\n        .post(\"http://localhost:8000/hello/answer \", {\n          \"word\": key_word,\n        })\n        .then(function (response) {\n          console.log(response.data.sentence);\n          _this.speak(response.data.sentence);\n          console.log(response.data);\n          _this.word = \"\";\n        });\n    },\n    async analysis(input_text) {\n      const text = input_text;\n      var key_word = \"\";\n      kuromoji.builder({ dicPath: \"/dict\" }).build((err, tokenizer) => {\n        if (err) {\n          console.log(err);\n        } else {\n          const tokens = tokenizer.tokenize(text);\n          for (let token of tokens) {\n            if (token.pos == \"名詞\") {\n              console.log(\"token: \", token.basic_form);\n              key_word = token.basic_form;\n            }\n          }\n          console.log(\"for key_word: \", key_word);\n          // this.speak(key_word);\n          this.api_post(key_word);\n\n        }\n      });\n    },\n    aiduti() {\n      const uttr = new SpeechSynthesisUtterance();\n      var move_mouse_obj = this.move_mouse();\n      uttr.text = \"こんにちは。昨日の夜ご飯に何を食べましたか？\";\n      uttr.lang = \"ja\";\n      speechSynthesis.speak(uttr);\n      uttr.onend = function () {\n        clearInterval(move_mouse_obj);\n      };\n    },\n    async speak(key_word) {\n      const uttr = new SpeechSynthesisUtterance();\n      var move_mouse_obj = this.move_mouse();\n      uttr.text = key_word;\n      uttr.lang = \"ja\";\n      speechSynthesis.speak(uttr);\n      this.user_name = \"\";\n      const recognition = this.recognition;\n      // 喋り終わったら，口の動きを止める\n      uttr.onend = function () {\n        clearInterval(move_mouse_obj);\n        recognition.start();\n      };\n    },\n    move_mouse() {\n      this.move_mouse_obj = setInterval(() => {\n        this.count++;\n        if (this.count % 2 == 0) {\n          this.flag = true;\n        } else {\n          this.flag = false;\n        }\n      }, 500);\n      return this.move_mouse_obj;\n    },\n  },\n};\n</script>\n<style>\n.overlay {\n  position: absolute;\n}\n</style>\n"]}]}