{"remainingRequest":"/Users/ykin/Documents/Projects/v-cataro-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ykin/Documents/Projects/v-cataro-frontend/src/components/Recognition.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/Users/ykin/Documents/Projects/v-cataro-frontend/src/components/Recognition.vue","mtime":1635123435782},{"path":"/Users/ykin/Documents/Projects/v-cataro-frontend/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/ykin/Documents/Projects/v-cataro-frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/ykin/Documents/Projects/v-cataro-frontend/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/ykin/Documents/Projects/v-cataro-frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/ykin/Documents/Projects/v-cataro-frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5vdmVybGF5IHsKICBwb3NpdGlvbjogYWJzb2x1dGU7Cn0K"},{"version":3,"sources":["Recognition.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyQA;AACA;AACA","file":"Recognition.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <v-app>\n    <v-main>\n      <v-row>\n        <v-col align=\"center\">\n          <img\n            v-if=\"flag\"\n            src=\"../../public/CATARO_a_1.png\"\n            alt=\"open_mouse\"\n            width=\"450\"\n            height=\"auto\"\n          />\n          <img\n            v-else\n            src=\"../../public/CATARO_a_2.png\"\n            alt=\"close_mouse\"\n            width=\"450\"\n            height=\"auto\"\n          />\n        </v-col>\n      </v-row>\n      <v-btn @click=\"api_post()\">post</v-btn>\n      <div v-if=\"show_button\">\n        <v-row align=\"center\">\n          <v-col align=\"center\">\n            <v-btn color=\"primary\" @click=\"onclick()\"> 実験開始 </v-btn>\n          </v-col>\n        </v-row>\n      </div>\n      <div v-else>\n        <v-row align=\"center\">\n          <v-col align=\"center\">\n            <h3>実験が開始されました</h3>\n            <h4>対話開始まで10秒ほどかかる場合があります．</h4>\n          </v-col>\n        </v-row>\n      </div>\n      <v-row class=\"mt-5\">\n        <v-col align=\"center\">\n          <p>{{ text }}</p>\n        </v-col>\n      </v-row>\n      <v-row>\n        <v-col class=\"mx-4\">\n          <div>\n            <p>neutral: {{ neutral }}</p>\n            <p>happy: {{ happy }}</p>\n            <p>angry: {{ angry }}</p>\n            <p>sad: {{ sad }}</p>\n            <p>surprised: {{ surprised }}</p>\n            <p>fearful: {{ fearful }}</p>\n            <p>disgusted: {{ disgusted }}</p>\n          </div>\n        </v-col>\n        <v-col align=\"end\" class=\"mx-4\">\n          <video\n            ref=\"video\"\n            id=\"video\"\n            width=\"300\"\n            height=\"300\"\n            playsinline\n            muted\n            autoplay\n          ></video>\n          <canvas ref=\"canvas\" id=\"myCanvas\" width=\"1\" height=\"1\" />\n        </v-col>\n      </v-row>\n    </v-main>\n  </v-app>\n</template>\n\n<script>\n// import firebase from \"../firebase.js\";\nimport * as faceapi from \"face-api.js\";\nimport kuromoji from \"kuromoji\";\nimport axios from \"axios\";\n//import * as canvas from 'canvas';\n\nexport default {\n  name: \"voice\",\n  data() {\n    return {\n      show_button: true,\n      user_email: \"\",\n      word: \"\",\n      text: \"\",\n      angry: \"\",\n      disgusted: \"\",\n      fearful: \"\",\n      happy: \"\",\n      neutral: \"\",\n      sad: \"\",\n      surprised: \"\",\n      timestamp: \"\",\n      changed_id: \"\",\n      timer: null,\n      canvas: null,\n      video: null,\n      recognition: null,\n      key_word: \"\",\n      count: 0,\n      flag: false,\n      msg: \"\",\n      move_mouse_obj: null,\n      user_name: \"こんにちは。。\",\n      aiduti_obj: null,\n      recog_flag: 0,\n    };\n  },\n  mounted() {\n    //PCのフロントカメラを起動し、リアルタイムの映像をvideoタグに表示する\n    this.video = document.getElementById(\"video\");\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n      navigator.mediaDevices\n        .getUserMedia({ audio: false, video: true })\n        .then((stream) => {\n          this.video.srcObject = stream;\n        });\n    }\n\n    this.canvas = this.$refs.canvas;\n  },\n\n  methods: {\n    onclick() {\n      this.show_button = false;\n      // this.set_email();\n      this.init_recognition();\n    },\n\n\n    async init_recognition() {\n      this.recognition = new window.webkitSpeechRecognition();\n\n      this.recognition.lang = \"ja-JP\";\n      this.recognition.interimResults = true;\n      this.recognition.continuous = true;\n      this.recognition.onend = function () {\n        console.log(\"voice is ended\");\n      };\n      await faceapi.loadSsdMobilenetv1Model(\"/models\");\n      await faceapi.loadFaceExpressionModel(\"/models\");\n      this.face_recog();\n      console.log(\"complete\");\n      const text = \"こんにちは，今日は鶏を食べました．\";\n      console.log(text);\n      kuromoji.builder({ dicPath: \"/dict\" }).build((err, tokenizer) => {\n        if (err) {\n          console.log(err);\n        } else {\n          const tokens = tokenizer.tokenize(text);\n          for (let token of tokens) {\n            if (token.pos == \"名詞\") {\n              console.log(\"token: \", token.basic_form);\n              // const key_word = token.basic_form;\n            }\n          }\n        }\n        this.aiduti();\n        this.start_recognition();\n      });\n    },\n    start_recognition() {\n      this.recognition.onresult = (event) => {\n        for (let i = event.resultIndex; i < event.results.length; i++) {\n          let transcript = event.results[i][0].transcript;\n          if (event.results[i].isFinal) {\n            //finalTranscript += transcript;\n            this.text = transcript;\n            this.recognition.stop();\n            this.analysis(this.text);\n            this.face_recog();\n          }\n        }\n      };\n      this.recognition.start();\n    },\n    async face_recog() {\n      const detectionWithExpressions = await faceapi\n        .detectSingleFace(this.video)\n        .withFaceExpressions();\n\n      (this.neutral = detectionWithExpressions.expressions.neutral),\n        (this.happy = detectionWithExpressions.expressions.happy),\n        (this.sad = detectionWithExpressions.expressions.sad),\n        (this.angry = detectionWithExpressions.expressions.angry),\n        (this.fearful = detectionWithExpressions.expressions.fearful),\n        (this.disgusted = detectionWithExpressions.expressions.disgusted),\n        (this.surprised = detectionWithExpressions.expressions.surprised);\n\n      clearInterval(this.aiduti_obj);\n    },\n    api_post: function(key_word) {\n      let _this = this\n      axios\n        .post(\"http://localhost:8000/hello/answer \", {\n          \"word\": key_word,\n        })\n        .then(function (response) {\n          console.log(response.data.sentence);\n          _this.speak(response.data.sentence);\n          console.log(response.data);\n          _this.word = \"\";\n        });\n    },\n    async analysis(input_text) {\n      const text = input_text;\n      var key_word = \"\";\n      kuromoji.builder({ dicPath: \"/dict\" }).build((err, tokenizer) => {\n        if (err) {\n          console.log(err);\n        } else {\n          const tokens = tokenizer.tokenize(text);\n          for (let token of tokens) {\n            if (token.pos == \"名詞\") {\n              console.log(\"token: \", token.basic_form);\n              key_word = token.basic_form;\n            }\n          }\n          console.log(\"for key_word: \", key_word);\n          // this.speak(key_word);\n          this.api_post(key_word);\n\n        }\n      });\n    },\n    aiduti() {\n      const uttr = new SpeechSynthesisUtterance();\n      var move_mouse_obj = this.move_mouse();\n      uttr.text = \"こんにちは。昨日の夜ご飯に何を食べましたか？\";\n      uttr.lang = \"ja\";\n      speechSynthesis.speak(uttr);\n      uttr.onend = function () {\n        clearInterval(move_mouse_obj);\n      };\n    },\n    async speak(key_word) {\n      const uttr = new SpeechSynthesisUtterance();\n      var move_mouse_obj = this.move_mouse();\n      uttr.text = key_word;\n      uttr.lang = \"ja\";\n      speechSynthesis.speak(uttr);\n      this.user_name = \"\";\n      const recognition = this.recognition;\n      // 喋り終わったら，口の動きを止める\n      uttr.onend = function () {\n        clearInterval(move_mouse_obj);\n        recognition.start();\n      };\n    },\n    move_mouse() {\n      this.move_mouse_obj = setInterval(() => {\n        this.count++;\n        if (this.count % 2 == 0) {\n          this.flag = true;\n        } else {\n          this.flag = false;\n        }\n      }, 500);\n      return this.move_mouse_obj;\n    },\n  },\n};\n</script>\n<style>\n.overlay {\n  position: absolute;\n}\n</style>\n"]}]}